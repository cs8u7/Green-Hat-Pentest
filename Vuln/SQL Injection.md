## Define
- to inject sql query at server
- collect sensitive data and credetial
## Root Cause
- attacker can manipulate sql query because insecure input -> execute sql query 
## Bypass
- This is a simple sql query to select data form database
```sql
SELECT username FROM users WHERE username=“admin“ AND password=MD5(“admin”)
```
- the query would search the row which have username is admin and password is md5 hash string of input. But the idea is the result of the query is not change if it just search by username 
```sql
SELECT username FROM users WHERE username=“admin“
```
- so attacker can add a double quote to username's input to escapse the query syntax then cut the password check 
```sql
SELECT username FROM users WHERE username=“admin“ --" AND password=MD5(“admin”)
```
- in sql, user can consider about prority of operator in query  ![[Sql-pic1.png|550]] 
- so in a same sql query, operator OR after AND, base on default query to search username and password in database. hacker's idea is inject an OR operator in username's input -> operator AND occur first and hacker got 100% sure the output is false then sql just query with the query remainer
```sql
SELECT username FROM users WHERE username=“admin” OR 1=“2” AND password=MD5(“abc”)
```
## Bind SQLi
- Asks the database true or false questions and determines the answer based on the applications response
- This attack is often used when the web application is configured to show generic error messages
- When the database does not output data to the web page, an attacker is forced to steal data by asking the database a series of true or false questions.
### Content-based
- i consider a example URL 
```HTTP
http://newspaper.com/items.php?id=2
```
- so it would sends the following query to the database:
```SQL
SELECT title, description, body FROM items WHERE ID = 2
```
- The attacker's idea is inject to insecure param `id`, in example below, if this web app is vulnerable by SQLi, return result should be `FALSE`
```HTTP
http://newspaper.com/items.php?id=2 and 1=2
```
- This is the query in server side
```SQL
SELECT title, description, body FROM items WHERE ID = 2 and 1=2
```
- To confirm this hypothesis, attacker would try another payload in order to make sql server return `TRUE`
```SQL
http://newspaper.com/items.php?id=2 and 1=1
```
### Error-based SQL injection
- Error-based SQL injection refers to cases where you're able to use error messages to either extract or infer sensitive data from the database, even in blind contexts.
## Second Order SQLi
- [Main idea](https://infosecwriteups.com/the-wrath-of-second-order-sql-injection-c9338a51c6d) is store a malicious trigger in sql database then trigger it latter or base on web application behavior
- user save an username in database:` Alice1024; --`
- then while user re-login after a month, web should say hello to user: `Welcome back` + `username`
- Basically, web take data form sql with query 
```SQL
SELECT 'Welcome back, ' + username FROM users WHERE user_id = 123;
```
- But username is already poison
```SQL
SELECT 'Welcome back, ' + Alice1024; -- FROM users WHERE user_id = 123;
```
## Union Select
![[Pasted image 20240511114211.png]]

